<!DOCTYPE html>
<html>
<head>
    <title>Jaxon Final Test</title>
</head>
<body>
    <h1>Jaxon Final Test</h1>
    <div id="status">Testing...</div>
    
    <!-- Step 1: Load Jaxon core library -->
    <script src="https://cdn.jsdelivr.net/gh/jaxon-php/jaxon-js@4.0.9/dist/jaxon.core.js"></script>
    
    <!-- Step 2: Jaxon configuration -->
    <script>
        try {
            if(typeof jaxon.config == undefined)
                jaxon.config = {};
        }
        catch(e) {
            jaxon = {};
            jaxon.config = {};
        };

        jaxon.config.requestURI = "/async/process.php";
        jaxon.config.statusMessages = false;
        jaxon.config.waitCursor = true;
        jaxon.config.version = "Jaxon 4.x";
        jaxon.config.defaultMode = "asynchronous";
        jaxon.config.defaultMethod = "POST";
        jaxon.config.responseType = "JSON";
    </script>
    
    <!-- Step 3: Our namespace creation -->
    <script src="async/js/lotgd.jaxon.js"></script>
    
    <!-- Step 4: Simulated PHP-generated script -->
    <script>
        // This simulates what your PHP getScript() generates
        if(JaxonLotgd.Async.Handler.Mail === undefined) {
            JaxonLotgd.Async.Handler.Mail = {};
        }
        JaxonLotgd.Async.Handler.Mail.mailStatus = function() {
            return jaxon.request({ jxncls: 'Lotgd.Async.Handler.Mail', jxnmthd: 'mailStatus' }, { parameters: arguments });
        };
        
        if(JaxonLotgd.Async.Handler.Timeout === undefined) {
            JaxonLotgd.Async.Handler.Timeout = {};
        }
        JaxonLotgd.Async.Handler.Timeout.timeoutStatus = function() {
            return jaxon.request({ jxncls: 'Lotgd.Async.Handler.Timeout', jxnmthd: 'timeoutStatus' }, { parameters: arguments });
        };
        
        console.log('PHP-generated script completed successfully');
    </script>
    
    <!-- Step 5: Test -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const statusDiv = document.getElementById('status');
            
            setTimeout(function() {
                let success = true;
                let message = '';
                
                try {
                    if (typeof JaxonLotgd === 'undefined') {
                        success = false;
                        message = '? JaxonLotgd not defined';
                    } else if (!JaxonLotgd.Async || !JaxonLotgd.Async.Handler) {
                        success = false;
                        message = '? JaxonLotgd structure incomplete';
                    } else if (typeof JaxonLotgd.Async.Handler.Mail.mailStatus !== 'function') {
                        success = false;
                        message = '? Mail.mailStatus not a function';
                    } else {
                        message = '? All tests passed! JaxonLotgd working correctly.';
                    }
                } catch (e) {
                    success = false;
                    message = '? Error: ' + e.message;
                }
                
                statusDiv.innerHTML = message;
                statusDiv.style.color = success ? 'green' : 'red';
                
                console.log('Test result:', message);
                console.log('JaxonLotgd:', JaxonLotgd);
            }, 500);
        });
    </script>
</body>
</html>